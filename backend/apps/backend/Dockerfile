# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build @backend/backend`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t @backend/backend`.
FROM node:18-alpine

ENV HOST=0.0.0.0
ENV PORT=3000

WORKDIR /app

RUN addgroup --system backend && \
    adduser --system -G backend backend

# Copy root package files and configs
COPY package*.json ./
COPY nx.json ./
COPY tsconfig*.json ./
COPY eslint.config.mjs ./
COPY .prettierrc ./
COPY .prettierignore ./

# Copy the backend app files
COPY apps/backend ./apps/backend

# Install dependencies
RUN npm install

# Build the application
RUN npx nx build backend --output-path=dist

# Set ownership
RUN chown -R backend:backend .

USER backend

# The compiled output will be in dist
CMD [ "node", "dist/startup.js" ]
